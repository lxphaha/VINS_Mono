# zed2i相机使用

## 相机内参

这个内参在`/usr/local/zed/settings`中查看相机的内参，仅限于sdk

ros输出图像:内参在`rostopic echo /zed2i/zed_node/left/camera_info`中读取

==vins_mono需要的是T_imu_cam0==

不确定内参的准确程度？
需要标定？

1. zed相机的内参？找到对应的内参(在camera_info中)
2. 标定相机的内参？找到对应的内参和imu 的内参、联合标定

### 系统值

imu与相机：T_imu_cam0

```
 0.999945   0.0101402 -0.00272787      -0.002
 -0.0101334    0.999946  0.00249161      -0.023
 0.00275299 -0.00246383    0.999993     0.00022
          0           0           0           1
```
2k:
1104*621

vga: 640*360

左相机去畸变：
```
distortion_model: "plumb_bob"
D: [0.0, 0.0, 0.0, 0.0, 0.0]
K: [493.12091064453125, 0.0, 319.18212890625, 0.0, 493.12091064453125, 187.33084106445312, 0.0, 0.0, 1.0]
R: [1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0]
P: [493.12091064453125, 0.0, 319.18212890625, 0.0, 0.0, 493.12091064453125, 187.33084106445312, 0.0, 0.0, 0.0, 1.0, 0.0]
```

左相机未去畸变：
```
D: [-0.059671301394701004, -0.06355620175600052, 0.0, 4.919200000585988e-05, -0.0002835890045389533]
K: [476.12249755859375, 0.0, 318.6650085449219, 0.0, 476.3175048828125, 179.2834930419922, 0.0, 0.0, 1.0]
```

右相机去畸变：
```
D: [0.0, 0.0, 0.0, 0.0, 0.0]
K: [493.12091064453125, 0.0, 319.18212890625, 0.0, 493.12091064453125, 187.33084106445312, 0.0, 0.0, 1.0]
```

右相机未去畸变：
```
D: [-0.05872559919953346, -0.06531070172786713, 0.0, 0.00012821599375456572, 1.0293600098520983e-05]
K: [476.2550048828125, 0.0, 321.7300109863281, 0.0, 476.5274963378906, 193.312255859375, 0.0, 0.0, 1.0]
```

left与imu:	`/zed2i/zed_node/left_cam_imu_transform `

```
translation: 
  x: -0.0020000000949949026
  y: -0.023000003769993782
  z: 0.0002200000308221206
rotation: 
  x: -0.0012388783507049084
  y: -0.001370235811918974
  z: -0.005068491213023663
  w: 0.9999854564666748
```



## 标定相机

### [camera_calibration相机标定](https://blog.csdn.net/TengYun_zhang/article/details/123072847)





## imu 标定

离散值：200hz
```
gyr_n: 1.0219614587222572821604537989924e-4
gyr_w: 7.6635418027197093851094806893575e-7
acc_n: 7.9441311864484361289875703915164e-4
acc_w: 4.3264320844772316716792844448505e-5
```

重力：

 x: -1.2223907709121704
  y: 0.07208067923784256
  z: 9.688394546508789

### kalibr标定

[使用](https://blog.csdn.net/i_robots/article/details/114747281)

[ZED 2i 双目-IMU标定](https://blog.csdn.net/weixin_40599145/article/details/126899201)

命令行：相机标定

```
rosrun camera_calibration cameracalibrator.py --approximate 0.1 --size 8x6 --square 0.02 right:=/zed2i/zed_node/right/image_rect_color left:=/zed2i/zed_node/left/image_rect_color right_camera:=/zed2i/zed2_node/right left_camera:=/zed2i/zed_node/left --no-service-check
```

640*360：标定出的T_cam0_imu

```
 data: 
 [0.0034775113040986516, -0.999992310758429, 0.0018125504538369364, 
  -0.013748583270139614, -0.0018602011593337464, -0.9999037534231539,
  0.9998994366301015, 0.003452256604693782, -0.01375494642452113]
t:
[0.02368744604971605, -0.00068476918544764, -0.018235916091044788]
```

== imu与相机的坐标系不对，需要乘以个变换矩阵 ==





kalib标定出来的结果

  [0.0034775113040986516, -0.999992310758429, 0.0018125504538369364, 0.02368744604971605]
  [-0.013748583270139614, -0.0018602011593337464, -0.9999037534231539, -0.00068476918544764]
  [0.9998994366301015, 0.003452256604693782, -0.01375494642452113, -0.018235916091044788]
  [0.0, 0.0, 0.0, 1.0]


重新标定的结果：T_cam_imu
```
[0.0036704711759193986, -0.9999879305720811, 0.0032659380753689016, 
-0.013688950414021683, -0.003315899025666813, -0.9999008038051638,
0.9998995650953689, 0.003625399814776553, -0.013700956108017415]
t:
0.02158166123076754
0.0017499993714911969
-0.024531144782777767

T_imu_cam:
0.00367047  -0.999988 0.00326594 
 -0.013689 -0.0033159  -0.999901    
    0.9999  0.0036254  -0.013701 
    
 0.0215817,0.00175,-0.0245311
```

4.18

相机的标定不太准确，需要重新标定

ros:info的旋转参数不对

出来的是T_imu_cam的参数，需要求逆，参数不太对，坐标系不不太对

去了解sdk的标定

去了解相机的联合标定

## kalibra

```
rosbag record -O Kalib_data_HD720.bag /zed2i/zed_node/imu/data_raw /zed2i/zed_node/left/image_rect_color /zed2i/zed_node/right/image_rect_color
```



## vins_mono

运行命令：
```
roslaunch zed_wrapper zed2i.launch
roslaunch vins_estimator realsense_color.launch 
roslaunch vins_estimator vins_rviz.launch
```
出现漂移，估计是imu的参数问题



## 计划

20230415： 相机标定弄好，imu标定